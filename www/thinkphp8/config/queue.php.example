<?php

return [
    'default'     => 'kafka',
    'connections' => [
        'sync'     => [
            'type' => 'sync',
        ],
        'database' => [
            'type'       => 'database',
            'queue'      => 'default',
            'table'      => 'jobs',
            'connection' => null,
            'retry_after'=> 60,
        ],
        'redis'    => [
            'type'       => 'redis',
            'queue'      => 'default',
            'host'       => 'redis',
            'port'       => 6379,
            'password'   => '',
            'select'     => 0,
            'timeout'    => 0,
            'persistent' => false,
        ],
        'kafka' => [
            'type'  => 'kafka',
            'queue' => 'default-kafka',
            'host'  => 'kafka:9092',
            'brokers'    => 'kafka:9092',
            'topic'      => 'default-topic',
            'options' => [
                'group.id' => 'thinkphp_consumer_group',
                'auto.offset.reset' => 'earliest',
                'enable.auto.commit' => true,
                'auto.commit.interval.ms' => 1000,
                'socket.timeout.ms' => 30000,
                'session.timeout.ms' => 30000,
                'max.poll.interval.ms' => 300000,
                'client.id'  => 'thinkphp_client',
            ],
            'producer' => [
                'compression.codec' => 'snappy',
                'message.send.max.retries' => 3,
                'queue.buffering.max.messages' => 100000,
                'queue.buffering.max.ms' => 1000,
                'batch.num.messages' => 1000,
            ],
            'consumer' => [
                'group.id' => 'thinkphp_consumer_group',
                'enable.auto.commit' => true,
                'auto.commit.interval.ms' => 1000,
                'auto.offset.reset' => 'earliest',
                'session.timeout.ms' => 30000,
                'max.poll.interval.ms' => 300000,
            ],
            // 事务支持配置
            'transaction' => [
                'enabled' => true,
                'timeout' => 10000,
            ],
            // 负载均衡配置
            'balance' => [
                'message_rate_threshold' => 10.0,
                'consumer_partition_ratio' => 2.0,
                'min_message_rate' => 1.0,
                'check_interval' => 300,
            ],
            // 健康检查配置
            'health' => [
                'enabled' => true,
                'heartbeat_interval' => 30,
                'heartbeat_timeout' => 60,
            ],
            // 幂等性检查配置
            'idempotent' => [
                'enabled' => true,
                'expire_time' => 86400,
            ],
            // 死信队列配置
            'dead_letter' => [
                'enabled' => true,
                'expire_time' => 604800,
                'alert_threshold' => 10,
            ],
        ],
    ],
    // Sentry错误追踪配置
    'sentry' => [
        'dsn' => env('SENTRY_DSN', ''),
        'environment' => env('SENTRY_ENVIRONMENT', 'development'),
        'release' => env('SENTRY_RELEASE', '1.0.0'),
        'traces_sample_rate' => env('SENTRY_TRACES_SAMPLE_RATE', 0.2),
        'max_breadcrumbs' => env('SENTRY_MAX_BREADCRUMBS', 50),
    ],
    // 配置验证
    'config_validation' => [
        'enabled' => true,
        'strict' => false,
    ],
];